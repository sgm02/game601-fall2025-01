pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _update()

b0=btn(0) -- button0 state
b1=btn(1) -- button1 state
b2=btn(2) -- button2 state


px=(px+128)%128 -- no bounds left and right
pat+=1 -- increment state clock

-- idle state
if pstate==0 then
	pspr=0
	if (b0 or b1) change_state(1)
	if (b2) change_state(3)
	if (canfall()) change_state(2)
end

	



--walk state
	if pstate==1 then
		if (b0)pdir=-1
		if (b1)pdir=1
		px+=pdir*min(pat,2)
		pspr=flr(pat/2)%2
		
		if (not(b0 or b1)) change_state(0)
		if (b2) change_state (3)
		if (canfall()) change_state(2)
end

	
	
	
	--fall state
		if pstate==2 then
		pspr=2
		if (canfall()) then
		if (b0)px-=1--steer left
		if (b1)px+=1 --steer right
		py+=min(4,pat) --move the player
		if (not canfall())py=flr(py/8)*8 -- check ground contact
	else
		py=flr(py/8)*8 -- fix position when ground hit
		change_state(0)
	end
end


	--jump state
	if pstate==3 then
		pspr=2
		py-=6-pat
		if(b0)px-=2
		if(b1)px+=2
		if(not b2 or pat>7)	change_state(0)
end

--collisioncheck
	if abs(px-btn_x)<8 and abs(py-btn_y)<8 then
		btn_touched=true
	end
end





function change_state(s)
	pstate=s
	pat=0
end

function canfall()
		--get the map tile under player
	v=mget(flr((px+4)/8),flr((py+8)/8))
		--see if it's flagged as well
		return not fget (v,0)
end

		



-->8

-->8
function _init()
	px=20 --x pos
	py=64 --y pos
	pstate=0 --current player state
	pspr=0 --current sprite
	pdir=0 --current direction
	pat=0 --player state timer
	btn_x=40
	btn_y=95
	btn_touched=false
end

function _draw()
	--draw the world
	map(0,0,0,0,16,16)
	--draw player, use dir to mirror sprites
	spr(pspr,px,py,1,1,pdir==-1)
	if btn_touched then
		spr(7,btn_x,btn_y) --green
	else
		spr(5,btn_x,btn_y) --red
	end
end
__gfx__
000000000077700000000000000000000000000000000000cccccccc000000000000000000000000000000000000000000000000000000000000000000000000
007770000077700000666000000000000000000000000000cccccccc000000000000000000000000000000000000000000000000000000000000000000000000
007770000077700000666000000000000000000000888800cccccccc00bbbb000000000000000000000000000000000000000000000000000000000000000000
007770000007000000666000161111110000000000877800cccccccc00b77b000000000000000000000000000000000000000000000000000000000000000000
000700000007000000060000666666660000000000877800cccccccc00b77b000000000000000000000000000000000000000000000000000000000000000000
000700000077700006666600666666660000000000888800cccccccc00bbbb000000000000000000000000000000000000000000000000000000000000000000
007770000070700060000060666666660000000000000000cccccccc000000000000000000000000000000000000000000000000000000000000000000000000
007070000000000000000000000000000000000000000000cccccccc000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030306060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606061818000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000040000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000400000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004040000000000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
